<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سورة الكهف</title>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-202T10BQ0B"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-202T10BQ0B');
</script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 2rem 0;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition for dark mode */
        }
        .amiri-font {
            font-family: 'Amiri', serif;
            line-height: var(--amiri-line-height, 2.5); /* Use CSS variable for line height */
            font-size: var(--amiri-font-size, 2rem); /* Use CSS variable for font size */
            transition: font-size 0.2s ease, line-height 0.2s ease; /* Smooth transition for font size and line height */
        }
        .verse-container {
            border-bottom: 1px solid #e5e7eb; /* Light border between verses */
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            transition: border-color 0.3s ease, background-color 0.3s ease; /* Smooth transition for dark mode */
            background-color: #fcfcfc; /* Very light gray for verse background */
            border-radius: 0.75rem; /* Rounded corners for the verse container */
            padding: 1.5rem; /* Increased padding inside the verse container */
        }
        .verse-container:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .tafsir-content {
            background-color: #f9fafb; /* Lighter gray for tafsir background */
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
            font-size: 0.95rem;
            color: #4b5563; /* Gray-700 */
            line-height: 1.8;
            position: relative; /* For close button positioning */
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; /* Smooth transition for dark mode */
        }
        .tafsir-close-btn {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem; /* Adjusted for RTL */
            background-color: #ef4444; /* Red-500 */
            color: white;
            border: none;
            border-radius: 9999px; /* Full rounded */
            width: 24px; /* w-6 */
            height: 24px; /* h-6 */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .tafsir-close-btn:hover {
            background-color: #dc2626; /* Red-600 */
        }
        /* Custom message box styles */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .message-box {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); /* shadow-lg */
            max-width: 90%;
            width: 400px;
            text-align: center;
        }
        .message-box-content {
            margin-bottom: 1.5rem;
            font-size: 1.125rem; /* text-lg */
            color: #374151; /* text-gray-700 */
        }
        .message-box-button {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; /* font-semibold */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .message-box-button:hover {
            background-color: #4338ca; /* indigo-700; */
        }
        /* Pastel colors for tafsir buttons */
        .btn-pastel-blue { background-color: #a7d9f7; color: #1f2937; } /* light blue */
        .btn-pastel-blue:hover { background-color: #8acbe5; }
        .btn-pastel-green { background-color: #b2f0c8; color: #1f2937; } /* light green */
        .btn-pastel-green:hover { background-color: #92e0ac; }
        .btn-pastel-purple { background-color: #d8b2f0; color: #1f2937; } /* light purple */
        .btn-pastel-purple:hover { background-color: #c092e0; }
        .btn-pastel-orange { background-color: #f7d9a7; color: #1f2937; } /* light orange */
        .btn-pastel-orange:hover { background-color: #e5c08a; }
        .btn-pastel-red { background-color: #ffb2b2; color: #1f2937; } /* light red */
        .btn-pastel-red:hover { background-color: #e59999; }
        .btn-pastel-teal { background-color: #b2f0e0; color: #1f2937; } /* light teal */
        .btn-pastel-teal:hover { background-color: #92e0cc; }
        .btn-pastel-pink { background-color: #f0b2d8; color: #1f2937; } /* light pink */
        .btn-pastel-pink:hover { background-color: #e092c0; }


        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
        }
        body.dark-mode .container {
            background-color: #2d3748; /* Darker container */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        body.dark-mode .text-gray-900 {
            color: #e2e8f0; /* Light text for verse */
        }
        body.dark-mode .text-gray-800 {
            color: #cbd5e0; /* Lighter gray for general text */
        }
        body.dark-mode .text-gray-500 {
            color: #a0aec0; /* Even lighter gray */
        }
        body.dark-mode .verse-container {
            border-color: #4a5568; /* Darker border */
            background-color: #2c3541; /* Darker background for verse in dark mode */
        }
        body.dark-mode .tafsir-content {
            background-color: #4a5568; /* Darker tafsir background */
            border-color: #616e7f;
            color: #e2e8f0;
        }
        body.dark-mode .tafsir-close-btn {
            background-color: #ef4444; /* Keep red for close */
        }
        body.dark-mode .message-box {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        body.dark-mode .message-box-content {
            color: #e2e8f0;
        }
        body.dark-mode .bg-gray-200 {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .bg-gray-200:hover {
            background-color: #616e7f;
        }
        /* Adjusted tafsir button text color for dark mode to be readable */
        body.dark-mode .btn-pastel-blue,
        body.dark-mode .btn-pastel-green,
        body.dark-mode .btn-pastel-purple,
        body.dark-mode .btn-pastel-orange,
        body.dark-mode .btn-pastel-red,
        body.dark-mode .btn-pastel-teal,
        body.dark-mode .btn-pastel-pink {
            color: #e2e8f0; /* Light text for pastel buttons in dark mode, ensures readability */
        }

        /* Back to Top Button */
        #backToTopBtn {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed position */
            bottom: 20px; /* Place at the bottom */
            right: 20px; /* Place at the right */
            z-index: 99; /* Make sure it's on top */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: #d1d5db; /* Light gray background */
            color: #374151; /* Dark text for contrast */
            cursor: pointer; /* Add a mouse pointer on hover */
            padding: 15px; /* Some padding */
            border-radius: 50%; /* Rounded corners */
            font-size: 18px; /* Increase font size */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, transform 0.2s ease, color 0.3s ease;
        }
        #backToTopBtn:hover {
            background-color: #a0aec0; /* Darker gray on hover */
            transform: translateY(-2px);
        }
        body.dark-mode #backToTopBtn {
            background-color: #4a5568; /* Darker gray in dark mode */
            color: #e2e8f0; /* Light text in dark mode */
        }
        body.dark-mode #backToTopBtn:hover {
            background-color: #616e7f;
        }

        /* Utility Buttons Container (now only for the menu toggle) */
        .utility-buttons-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 101; /* Higher z-index to be on top of the menu */
        }
        .utility-btn {
            background-color: #6b7280; /* Gray-500 */
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .utility-btn:hover {
            background-color: #4b5563; /* Gray-600 */
            transform: translateY(-1px);
        }
        body.dark-mode .utility-btn {
            background-color: #4a5568; /* Darker gray in dark mode */
        }
        body.dark-mode .utility-btn:hover {
            background-color: #616e7f;
        }

        /* Side Menu Styles */
        .side-menu {
            position: fixed;
            top: 0;
            right: -250px; /* Initially hidden off-screen to the right */
            width: 250px;
            height: 100vh;
            background-color: #ffffff; /* White background */
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease-in-out;
            z-index: 100; /* Lower than toggle button, higher than content */
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: flex-start;
        }
        .side-menu.open {
            right: 0; /* Slide in */
        }
        body.dark-mode .side-menu {
            background-color: #2d3748; /* Darker background in dark mode */
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
        }
        .side-menu .menu-item-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background-color: #e5e7eb; /* Light gray */
            color: #374151; /* Dark gray text */
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .side-menu .menu-item-btn:hover {
            background-color: #d1d5db; /* Darker light gray on hover */
        }
        body.dark-mode .side-menu .menu-item-btn {
            background-color: #4a5568; /* Darker gray in dark mode */
            color: #e2e8f0; /* Light text */
        }
        body.dark-mode .side-menu .menu-item-btn:hover {
            background-color: #616e7f;
        }

        .button-icon {
            margin-left: 0.5rem; /* Space between icon and text for RTL */
        }
        .basmala {
            font-size: 1.5rem; /* Changed to 1.5rem for 2xl */
            margin-top: 1rem;
            margin-bottom: 2rem;
            color: #4a5568; /* Slightly darker gray for contrast */
            transition: color 0.3s ease;
        }
        body.dark-mode .basmala {
            color: #cbd5e0; /* Lighter color in dark mode */
        }

        /* Bookmark Highlight - Updated colors for better visibility */
        .verse-bookmarked {
            background-color: #fef9c3; /* A more visible light yellow (yellow-100) */
            border: 1px solid #facc15; /* A more prominent yellow border (yellow-400) */
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        body.dark-mode .verse-bookmarked {
            background-color: #78350f; /* A darker, but distinct, yellow/orange (amber-900) */
            border-color: #d97706; /* Still a prominent orange border (amber-700) */
        }
    </style>
</head>
<body class="antialiased">
    <div class="utility-buttons-container">
        <button id="moreOptionsBtn" class="utility-btn" title="المزيد من الخيارات">
            <i class="fas fa-ellipsis-v"></i>
        </button>
    </div>

    <div id="sideMenu" class="side-menu">
        <h2 class="text-xl font-bold text-gray-800 mb-4">خيارات القراءة</h2>
        
        <button id="decreaseFontSizeBtn" class="menu-item-btn" title="تصغير الخط">
            <i class="fas fa-magnifying-glass-minus"></i>
            <span>تصغير الخط</span>
        </button>
        <button id="increaseFontSizeBtn" class="menu-item-btn" title="تكبير الخط">
            <i class="fas fa-magnifying-glass-plus"></i>
            <span>تكبير الخط</span>
        </button>
        <button id="darkModeToggle" class="menu-item-btn" title="الوضع الليلي/النهاري">
            <i class="fas fa-moon"></i>
            <span>الوضع الليلي/النهاري</span>
        </button>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl bg-white rounded-xl shadow-lg">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-2 amiri-font">﴿سورة الكهف﴾</h1>
        <p class="text-center amiri-font basmala">﷽</p>

        <div id="surah-content">
            </div>

        <div id="messageBoxOverlay" class="message-box-overlay hidden">
            <div class="message-box">
                <p id="messageBoxContent" class="message-box-content"></p>
                <button id="messageBoxClose" class="message-box-button">إغلاق</button>
            </div>
        </div>
    </div>

    <button onclick="scrollToTop()" id="backToTopBtn" title="العودة للأعلى">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Function to show a custom message box
        function showMessageBox(message) {
            const overlay = document.getElementById('messageBoxOverlay');
            const content = document.getElementById('messageBoxContent');
            const closeButton = document.getElementById('messageBoxClose');

            content.textContent = message;
            overlay.classList.remove('hidden');

            closeButton.onclick = () => {
                overlay.classList.add('hidden');
            };

            // Close when clicking outside the box
            overlay.onclick = (event) => {
                if (event.target === overlay) {
                    overlay.classList.add('hidden');
                }
            };
        }

        // Sample data for Surah Al-Kahf verses with placeholder tafsir texts
        const verses = [
            {
                number: 1,
                text: "الْحَمْدُ لِلَّهِ الَّذِي أَنزَلَ عَلَىٰ عَبْدِهِ الْكِتَابَ وَلَمْ يَجْعَل لَّهُ عِوَجًا ۜ",
                tafsir: {
                    mukhtasar: "هذا تفسير مختصر للآية الأولى: الثناء كله لله الذي أنزل القرآن على عبده محمد صلى الله عليه وسلم، وجعله مستقيمًا لا اعوجاج فيه.",
                    ibnKathir: "تفسير ابن كثير للآية الأولى: يخبر تعالى عن نفسه الكريمة بأنه المستحق لجميع المحامد، لأنه أنزل على عبده ورسوله محمد صلى الله عليه وسلم هذا الكتاب العظيم، وهو القرآن الكريم، الذي لا اعوجاج فيه ولا ميل، بل هو مستقيم لا لبس فيه ولا غموض.",
                    saadi: "تفسير السعدي للآية الأولى: يثني تعالى على نفسه الكريمة، بإنزاله هذا الكتاب العظيم، على عبده ورسوله محمد صلى الله عليه وسلم، الذي جعله مستقيمًا، لا عوج فيه، ولا ميل عن الحق.",
                    tadabbur: "تدبر الآية الأولى: تأمل كيف يبدأ الله تعالى السورة بالحمد لنفسه، وذلك لأنه المنعم المتفضل بإنزال هذا الكتاب الذي هو هداية ونور، وكيف وصف الكتاب بأنه لا اعوجاج فيه، مما يدل على كماله وشموليته.",
                    tabari: "تفسير الطبري للآية الأولى: القول في تأويل قوله تعالى: (الحمد لله الذي أنزل على عبده الكتاب ولم يجعل له عوجا). يقول تعالى ذكره: الشكر الكامل لله الذي أنزل على عبده محمد صلى الله عليه وسلم القرآن، ولم يجعل فيه اعوجاجًا عن الحق.",
                    baghawi: "تفسير البغوي للآية الأولى: (الحمد لله الذي أنزل على عبده الكتاب) يعني القرآن (ولم يجعل له عوجا) أي: لم يجعل فيه اختلافًا ولا تناقضًا.",
                    qurtubi: "تفسير القرطبي للآية الأولى: قوله تعالى: (الحمد لله الذي أنزل على عبده الكتاب) أي: القرآن، وهو كلام الله غير مخلوق، أنزله على عبده محمد صلى الله عليه وسلم. (ولم يجعل له عوجا) أي: لم يجعل فيه ميلاً عن الحق، ولا زيغًا عن الاستقامة."
                }
            },
            {
                number: 2,
                text: "قَيِّمًا لِّيُنذِرَ بَأْسًا شَدِيدًا مِّن لَّدُنْهُ وَيُبَشِّرَ الْمُؤْمِنِينَ الَّذِينَ يَعْمَلُونَ الصَّالِحَاتِ أَنَّ لَهُمْ أَجْرًا حَسَنًا",
                tafsir: {
                    mukhtasar: "تفسير مختصر للآية الثانية: جعله مستقيمًا لينذر عذابًا شديدًا من عنده، ويبشر المؤمنين الذين يعملون الصالحات بأن لهم ثوابًا حسنًا.",
                    ibnKathir: "تفسير ابن كثير للآية الثانية: أي: جعله قيمًا، أي: مستقيمًا معتدلاً، لينذر به الكافرين عقابًا شديدًا من عنده، ويبشر المؤمنين الذين يعملون الأعمال الصالحة بأن لهم ثوابًا حسنًا، وهو الجنة.",
                    saadi: "تفسير السعدي للآية الثانية: أي: مستقيمًا في ألفاظه ومعانيه، لا نقص فيه ولا خلل، لينذر به من كفر بالله، ويبشر به من آمن به وعمل الصالحات بأن لهم أجرًا حسنًا.",
                    tadabbur: "تدبر الآية الثانية: لاحظ التوازن بين الإنذار والتبشير في القرآن. فهو لا يقتصر على التخويف، بل يفتح باب الأمل والرجاء للمؤمنين العاملين للصالحات، مما يحفز على العمل الصالح.",
                    tabari: "تفسير الطبري للآية الثانية: (قيما) أي مستقيما، (لينذر بأسا شديدا) أي عذابا شديدا (من لدنه) أي من عنده، (ويبشر المؤمنين الذين يعملون الصالحات أن لهم أجرا حسنا) وهو الجنة.",
                    baghawi: "تفسير البغوي للآية الثانية: (قيما) أي مستقيما، (لينذر بأسا شديدا) أي عذابا شديدا (من لدنه) أي من قبله، (ويبشر المؤمنين الذين يعملون الصالحات أن لهم أجرا حسنا) وهو الجنة.",
                    qurtubi: "تفسير القرطبي للآية الثانية: قوله تعالى: (قيما) أي مستقيما لا عوج فيه ولا أمت، (لينذر بأسا شديدا من لدنه) أي: عذابا شديدا من عنده، (ويبشر المؤمنين الذين يعملون الصالحات أن لهم أجرا حسنا) وهو الجنة."
                }
            },
            {
                number: 3,
                text: "مَّاكِثِينَ فِيهِ أَبَدًا",
                tafsir: {
                    mukhtasar: "تفسير مختصر للآية الثالثة: مقيمين في هذا الأجر الحسن دائمًا لا يخرجون منه.",
                    ibnKathir: "تفسير ابن كثير للآية الثالثة: أي: في هذا الأجر الحسن، وهو الجنة، ماكثين فيه أبدًا لا يزولون ولا يتحولون.",
                    saadi: "تفسير السعدي للآية الثالثة: أي: دائمين في هذا الأجر، وهو الجنة، لا يخرجون منها أبدًا.",
                    tadabbur: "تدبر الآية الثالثة: كلمة 'أبدًا' تؤكد على خلود النعيم للمؤمنين، وهذا يزيد من قيمة الأجر ويشجع على الاستقامة والثبات على الطاعات.",
                    tabari: "تفسير الطبري للآية الثالثة: (ماكثين فيه أبدا) أي: مقيمين في هذا الأجر الحسن الذي وعدهم الله به أبدا، لا يزول عنهم ولا يحول.",
                    baghawi: "تفسير البغوي للآية الثالثة: (ماكثين فيه أبدا) أي: مقيمين في الأجر الحسن أبدا لا يخرجون منه.",
                    qurtubi: "تفسير القرطبي للآية الثالثة: قوله تعالى: (ماكثين فيه أبدا) أي: دائمين في هذا الأجر الحسن، وهو الجنة، لا يخرجون منها أبدا."
                }
            },
            {
                number: 4,
                text: "وَيُنذِرَ الَّذِينَ قَالُوا اتَّخَذَ اللَّهُ وَلَدًا",
                tafsir: {
                    mukhtasar: "تفسير مختصر للآية الرابعة: وينذر أيضًا الذين زعموا أن الله اتخذ ولدًا.",
                    ibnKathir: "تفسير ابن كثير للآية الرابعة: أي: وينذر بهذا القرآن أيضًا الذين قالوا زورًا وبهتانًا إن الله اتخذ ولدًا، كاليهود والنصارى والمشركين.",
                    saadi: "تفسير السعدي للآية الرابعة: أي: وينذر الذين قالوا على الله الكذب والافتراء، وزعموا أن الله اتخذ ولدًا، كاليهود والنصارى والمشركين.",
                    tadabbur: "تدبر الآية الرابعة: الآية تحذر بشدة من أعظم الكذب والافتراء على الله، وهو نسبة الولد إليه، مما يدل على خطورة هذا القول وعظيم جرمه.",
                    tabari: "تفسير الطبري للآية الرابعة: (وينذر الذين قالوا اتخذ الله ولدا) وهم اليهود والنصارى والمشركون الذين زعموا لله ولدا.",
                    baghawi: "تفسير البغوي للآية الرابعة: (وينذر الذين قالوا اتخذ الله ولدا) يعني اليهود والنصارى والمشركين.",
                    qurtubi: "تفسير القرطبي للآية الرابعة: قوله تعالى: (وينذر الذين قالوا اتخذ الله ولدا) أي: وهم اليهود والنصارى والمشركون."
                }
            },
            {
                number: 5,
                text: "مَّا لَهُم بِهِ مِنْ عِلْمٍ وَلَا لِآبَائِهِمْ ۚ كَبُرَتْ كَلِمَةً تَخْرُجُ مِنْ أَفْوَاهِهِمْ ۚ إِن يَقُولُونَ إِلَّا كَذِبًا",
                tafsir: {
                    mukhtasar: "تفسير مختصر للآية الخامسة: ليس لديهم أي علم بذلك، ولا لآبائهم السابقين. عظمت تلك الكلمة التي تخرج من أفواههم، إنهم لا يقولون إلا كذبًا.",
                    ibnKathir: "تفسير ابن كثير للآية الخامسة: أي: ما لهؤلاء الذين قالوا ذلك، ولا لآبائهم الذين قلدوهم فيه، من علم صحيح يدل على ما قالوه، بل هو قول باطل لا أساس له. عظمت هذه الكلمة الشنيعة التي تخرج من أفواههم، إنهم لا يقولون إلا كذبًا وافتراءً على الله.",
                    saadi: "تفسير السعدي للآية الخامسة: أي: ليس عندهم ولا عند أسلافهم من علم يدل على صحة ما قالوه، بل هو مجرد افتراء وكذب. فما أعظم هذه الكلمة وأشنعها التي تخرج من أفواههم، إنما يقولون كذبًا محضًا.",
                    tadabbur: "تدبر الآية الخامسة: الآية تؤكد على أن هذا القول لا يستند إلى علم أو دليل، بل هو محض افتراء. وتصف الكلمة بأنها 'كبرت كلمة'، مما يدل على فظاعتها وعظمها في ميزان الله.",
                    tabari: "تفسير الطبري للآية الخامسة: (ما لهم به من علم) أي: ما لهؤلاء القائلين: (اتخذ الله ولدا) بذلك القول من علم، (ولا لآبائهم) الذين قلَّدوهم فيه، (كبرت كلمة تخرج من أفواههم) يقول: عظمت كلمة تخرج من أفواههم، (إن يقولون إلا كذبا) يقول: ما يقولون إلا كذبا وافتراء على الله.",
                    baghawi: "تفسير البغوي للآية الخامسة: (ما لهم به من علم ولا لآبائهم) الذين اقتدوا بهم، (كبرت كلمة تخرج من أفواههم) أي: عظمت تلك الكلمة قولا، (إن يقولون إلا كذبا) أي: ما يقولون إلا كذبا.",
                    qurtubi: "تفسير القرطبي للآية الخامسة: قوله تعالى: (ما لهم به من علم ولا لآبائهم) أي: ما لهم بهذا القول من علم، ولا لآبائهم الذين اتبعوهم. (كبرت كلمة تخرج من أفواههم) أي: عظمت هذه الكلمة التي تخرج من أفواههم، (إن يقولون إلا كذبا) أي: ما يقولون إلا كذبا."
                }
            }
            // Add more verses here with their tafsir texts
        ];

        const surahContentDiv = document.getElementById('surah-content');
        const websiteLink = "https://your-website.com/surah-alkahf"; // رابط افتراضي لموقعك

        // --- Side Menu Functionality ---
        const moreOptionsBtn = document.getElementById('moreOptionsBtn');
        const sideMenu = document.getElementById('sideMenu');

        moreOptionsBtn.addEventListener('click', (event) => {
            event.stopPropagation(); // Prevent click from propagating to document and closing menu
            sideMenu.classList.toggle('open');
        });

        // Close side menu if clicked outside
        document.addEventListener('click', (event) => {
            // Check if the click is outside the side menu and the toggle button
            if (!sideMenu.contains(event.target) && !moreOptionsBtn.contains(event.target) && sideMenu.classList.contains('open')) {
                sideMenu.classList.remove('open');
            }
        });


        // --- Font Size Functionality (Separate Increase/Decrease Buttons) ---
        const decreaseFontSizeBtn = document.getElementById('decreaseFontSizeBtn');
        const increaseFontSizeBtn = document.getElementById('increaseFontSizeBtn');

        let currentFontSizeLevel = 0; // 0: smallest, 1: small, 2: medium, 3: large

        const fontSettings = [
            { fontSize: '1.8rem', lineHeight: '2.4' }, // Level 0 (Smallest)
            { fontSize: '2.0rem', lineHeight: '2.6' }, // Level 1 (Small)
            { fontSize: '2.2rem', lineHeight: '2.8' }, // Level 2 (Medium)
            { fontSize: '2.4rem', lineHeight: '3.0' }  // Level 3 (Largest)
        ];

        // Function to apply font size and line height
        function applyFontSize() {
            const root = document.documentElement;
            root.style.setProperty('--amiri-font-size', fontSettings[currentFontSizeLevel].fontSize);
            root.style.setProperty('--amiri-line-height', fontSettings[currentFontSizeLevel].lineHeight);
        }

        // Event listener for increase font size button
        increaseFontSizeBtn.addEventListener('click', () => {
            if (currentFontSizeLevel < fontSettings.length - 1) {
                currentFontSizeLevel++;
                applyFontSize();
            } else {
                showMessageBox('لقد وصلت إلى أقصى حجم للخط.');
            }
        });

        // Event listener for decrease font size button
        decreaseFontSizeBtn.addEventListener('click', () => {
            if (currentFontSizeLevel > 0) {
                currentFontSizeLevel--;
                applyFontSize();
            } else {
                showMessageBox('لقد وصلت إلى أدنى حجم للخط.');
            }
        });

        // --- Dark/Light Mode Functionality ---
        const darkModeToggle = document.getElementById('darkModeToggle');
        const body = document.body;
        const darkModeIcon = darkModeToggle.querySelector('i');

        // Check local storage for dark mode preference
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // Function to apply dark mode
        function applyDarkMode() {
            if (isDarkMode) {
                body.classList.add('dark-mode');
                darkModeIcon.classList.remove('fa-moon');
                darkModeIcon.classList.add('fa-sun');
            } else {
                body.classList.remove('dark-mode');
                darkModeIcon.classList.remove('fa-sun');
                darkModeIcon.classList.add('fa-moon');
            }
        }

        // Event listener for dark mode toggle
        darkModeToggle.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            localStorage.setItem('darkMode', isDarkMode);
            applyDarkMode();
            showMessageBox(isDarkMode ? 'تم تفعيل الوضع الليلي' : 'تم تفعيل الوضع النهاري');
        });

        // Apply dark mode on initial load
        applyDarkMode();

        // --- Back to Top Button Functionality ---
        const backToTopBtn = document.getElementById('backToTopBtn');

        // Show/hide the button based on scroll position
        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        };

        // Scroll to the top of the document
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth' // Smooth scroll
            });
        }

        // --- Bookmark Functionality ---
        const BOOKMARK_KEY = 'surahAlKahfBookmark';
        let bookmarkedVerseNumber = localStorage.getItem(BOOKMARK_KEY);

        // Function to highlight a bookmarked verse
        function highlightBookmarkedVerse(verseNumber) {
            // Remove existing highlights
            document.querySelectorAll('.verse-bookmarked').forEach(el => {
                el.classList.remove('verse-bookmarked');
            });

            if (verseNumber) {
                const verseDiv = document.getElementById(`verse-${verseNumber}`);
                if (verseDiv) {
                    verseDiv.classList.add('verse-bookmarked');
                }
            }
        }

        // Function to toggle bookmark
        function toggleBookmark(verseNumber) {
            if (bookmarkedVerseNumber == verseNumber) {
                // Remove bookmark
                localStorage.removeItem(BOOKMARK_KEY);
                bookmarkedVerseNumber = null;
                showMessageBox(`تم إزالة الإشارة المرجعية من الآية رقم ${verseNumber}.`);
            } else {
                // Set new bookmark
                localStorage.setItem(BOOKMARK_KEY, verseNumber);
                bookmarkedVerseNumber = verseNumber;
                showMessageBox(`تم وضع إشارة مرجعية عند الآية رقم ${verseNumber}.`);
            }
            highlightBookmarkedVerse(bookmarkedVerseNumber); // Update UI
        }


        // --- Render Verses ---
        verses.forEach(verse => {
            const verseDiv = document.createElement('div');
            verseDiv.className = 'verse-container mb-4'; // Added mb-4 for spacing between verse containers
            verseDiv.id = `verse-${verse.number}`; // Add ID for bookmarking

            const verseText = document.createElement('p');
            verseText.className = 'text-gray-900 mb-4 amiri-font text-justify'; // Controlled by CSS variable
            verseText.innerHTML = `${verse.text} <span class="text-sm text-gray-500">(${verse.number})</span>`;
            verseDiv.appendChild(verseText);

            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex flex-wrap gap-2 sm:gap-3 justify-center md:justify-start';

            // Tafsir Buttons - Updated with pastel colors and new tafsirs
            const tafsirButtons = [
                { name: 'المختصر', key: 'mukhtasar', color: 'btn-pastel-blue' },
                { name: 'ابن كثير', key: 'ibnKathir', color: 'btn-pastel-green' },
                { name: 'السعدي', key: 'saadi', color: 'btn-pastel-purple' },
                { name: 'الطبري', key: 'tabari', color: 'btn-pastel-red' },
                { name: 'البغوي', key: 'baghawi', color: 'btn-pastel-teal' },
                { name: 'القرطبي', key: 'qurtubi', color: 'btn-pastel-pink' },
                { name: 'تدبر القرآن الكريم', key: 'tadabbur', color: 'btn-pastel-orange' }
            ];

            // Display first 3 tafsir buttons
            const initialTafsirCount = 3;
            for (let i = 0; i < Math.min(tafsirButtons.length, initialTafsirCount); i++) {
                const btnInfo = tafsirButtons[i];
                const button = document.createElement('button');
                button.className = `px-3 py-1.5 sm:px-4 sm:py-2 text-gray-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 ${btnInfo.color}`;
                button.textContent = `تفسير ${btnInfo.name}`;
                button.onclick = () => {
                    displayTafsir(verseDiv, verse.tafsir[btnInfo.key], btnInfo.name);
                };
                buttonsContainer.appendChild(button);
            }

            // If there are more tafsirs than initialTafsirCount, add a "More" button
            if (tafsirButtons.length > initialTafsirCount) {
                const moreButton = document.createElement('button');
                moreButton.className = 'px-3 py-1.5 sm:px-4 sm:py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300';
                moreButton.textContent = '... المزيد';
                buttonsContainer.appendChild(moreButton);

                const hiddenTafsirsDiv = document.createElement('div');
                hiddenTafsirsDiv.className = 'flex flex-wrap gap-2 sm:gap-3 hidden mt-2'; // Initially hidden, added margin-top
                buttonsContainer.appendChild(hiddenTafsirsDiv);

                // Add remaining tafsir buttons to the hidden div
                for (let i = initialTafsirCount; i < tafsirButtons.length; i++) {
                    const btnInfo = tafsirButtons[i];
                    const button = document.createElement('button');
                    button.className = `px-3 py-1.5 sm:px-4 sm:py-2 text-gray-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 ${btnInfo.color}`;
                    button.textContent = `تفسير ${btnInfo.name}`;
                    button.onclick = () => {
                        displayTafsir(verseDiv, verse.tafsir[btnInfo.key], btnInfo.name);
                    };
                    hiddenTafsirsDiv.appendChild(button);
                }

                moreButton.onclick = () => {
                    moreButton.classList.add('hidden');
                    hiddenTafsirsDiv.classList.remove('hidden');
                };
            }


            // Copy Button - Light gray background remains, added icon
            const copyButton = document.createElement('button');
            copyButton.className = 'px-3 py-1.5 sm:px-4 sm:py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 flex items-center';
            copyButton.innerHTML = '<i class="fas fa-copy button-icon"></i> نسخ';
            copyButton.onclick = () => {
                const textToCopy = `${verse.text}\nرابط الموقع: ${websiteLink}`;
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? 'تم نسخ الآية والرابط!' : 'فشل النسخ.';
                    showMessageBox(msg);
                } catch (err) {
                    showMessageBox('فشل النسخ: ' + err);
                }
                document.body.removeChild(textArea);
            };
            buttonsContainer.appendChild(copyButton);

            // Share Button - Light gray background remains, added icon
            const shareButton = document.createElement('button');
            shareButton.className = 'px-3 py-1.5 sm:px-4 sm:py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 flex items-center';
            shareButton.innerHTML = '<i class="fas fa-share-alt button-icon"></i> مشاركة';
            shareButton.onclick = async () => {
                const shareData = {
                    title: 'سورة الكهف - الآية ' + verse.number,
                    text: verse.text,
                    url: websiteLink
                };

                if (navigator.share) {
                    try {
                        await navigator.share(shareData);
                        showMessageBox('تمت المشاركة بنجاح!');
                    } catch (err) {
                        showMessageBox('فشل المشاركة: ' + err.message + '. تم نسخ الآية والرابط بدلاً من ذلك.');
                        const textToCopy = `${verse.text}\nرابط الموقع: ${websiteLink}`;
                        const textArea = document.createElement('textarea');
                        textArea.value = textToCopy;
                        textArea.style.position = 'fixed';
                        textArea.style.opacity = '0';
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                    }
                } else {
                    showMessageBox('متصفحك لا يدعم واجهة المشاركة. تم نسخ الآية والرابط بدلاً من ذلك.');
                    const textToCopy = `${verse.text}\nرابط الموقع: ${websiteLink}`;
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
            };
            buttonsContainer.appendChild(shareButton);

            // Bookmark Button
            const bookmarkButton = document.createElement('button');
            bookmarkButton.className = 'px-3 py-1.5 sm:px-4 sm:py-2 bg-yellow-200 hover:bg-yellow-300 text-yellow-800 font-medium rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-300 flex items-center';
            bookmarkButton.innerHTML = '<i class="fas fa-bookmark button-icon"></i> إشارة مرجعية';
            bookmarkButton.onclick = () => {
                toggleBookmark(verse.number);
            };
            buttonsContainer.appendChild(bookmarkButton);


            verseDiv.appendChild(buttonsContainer);

            // Create a div for tafsir content, initially hidden
            const tafsirDisplayDiv = document.createElement('div');
            tafsirDisplayDiv.className = 'tafsir-content hidden'; // Hidden by default
            verseDiv.appendChild(tafsirDisplayDiv);

            surahContentDiv.appendChild(verseDiv);
        });

        // Function to display tafsir content
        function displayTafsir(verseContainer, tafsirText, tafsirName) {
            const tafsirDisplayDiv = verseContainer.querySelector('.tafsir-content');

            // Clear previous content
            tafsirDisplayDiv.innerHTML = '';

            // Add tafsir text
            const tafsirParagraph = document.createElement('p');
            tafsirParagraph.innerHTML = `<strong class="text-gray-900">${tafsirName}:</strong> ${tafsirText}`;
            tafsirDisplayDiv.appendChild(tafsirParagraph);

            // Add close button
            const closeButton = document.createElement('button');
            closeButton.className = 'tafsir-close-btn';
            closeButton.textContent = 'X';
            closeButton.onclick = () => {
                tafsirDisplayDiv.classList.add('hidden');
            };
            tafsirDisplayDiv.appendChild(closeButton);

            // Show the tafsir div
            tafsirDisplayDiv.classList.remove('hidden');
        }

        // Apply initial font size and highlight bookmark after all verses are rendered
        applyFontSize();
        highlightBookmarkedVerse(bookmarkedVerseNumber);
    </script>
</body>
</html>
